{"version":3,"file":"GoodsDetail.js","sources":["pages/GoodsDetail/GoodsDetail.vue","D:/ -- HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvR29vZHNEZXRhaWwvR29vZHNEZXRhaWwudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 商品大图 -->\n    <view class=\"goods-image-container\">\n      <image :src=\"goods.cardGraph\" mode=\"aspectFill\" class=\"goods-image\" alt=\"商品图片\"></image>\n    </view>\n\n    <!-- 商品信息 -->\n    <view class=\"goods-info\">\n      <view class=\"goods-title-container\">\n        <text class=\"goods-title\">{{ goods.name }}</text>\n        <text class=\"goods-rare\">{{ goods.rarity }}</text>\n      </view>\n      <text class=\"goods-code\">编号: {{ goods.cardNumber }}</text>\n      <!-- 卖家和价格 -->\n      <view class=\"seller-price-container\">\n        <text class=\"seller-name\">卖家: {{ goods.sellerId }}</text>\n        <text class=\"goods-price\">¥{{ goods.price || '暂无价格' }}</text>\n      </view>\n    </view>\n\n    <!-- 操作按钮 -->\n    <view class=\"action-buttons\">\n      <button \n        class=\"action-button collect-btn\" \n        :class=\"{ 'collected': goods.isCollected }\"\n        @click=\"toggleCollect\"\n      >\n        <text class=\"action-icon\">{{ goods.isCollected ? '⭐' : '☆' }}</text>\n        <text class=\"action-text\">{{ goods.isCollected ? '已收藏' : '收藏' }}</text>\n      </button>\n      <button class=\"action-button report-btn\" @click=\"Buy\">\n        <text class=\"action-icon\">🛒</text>\n        <text class=\"action-text\">购买</text>\n      </button>\n    </view>\n<!--发消息给卖家 -->\n    <view class=\"message-seller\">\n      <view class=\"message-title\">发消息给卖家</view>\n      <textarea \n        class=\"message-input\" \n        placeholder=\"请输入消息内容...\"\n        v-model=\"messageContent\"\n        auto-height\n      ></textarea>\n      <button class=\"send-button\" @click=\"sendMessage\">发送</button>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      goods: {\n        attention: 0,\n        cardGraph: '空',\n        name: '示例商品名称示例商品名称',\n        rarity: 'superBigCup',\n        price: 99.9, \n        cardNumber: 'ABC123456',\n        sellerId: '101',\n        id: null,\n        isCollected: false\n      },\n      allGoodsList: [],\n      collectedGoodsList: [],\r\n\t  messageContent: ''\n    }\n  },\n  methods: {\n    // 获取用户收藏列表\n    getCollectedCards() {\n      const cookies = uni.getStorageSync('cookies');\n      uni.request({\n        url: 'http://127.0.0.1:8080/userFavorite/get',\n        method: 'POST',\n        header: {\n          'Cookie': cookies\n        },\n        success: (res) => {\n          if (res.data.code === 0) {\n            this.collectedGoodsList = res.data.data || [];\n            // 重新检查当前商品是否被收藏\n            if (this.goods.id) {\n              this.checkCollectionStatus();\n            }\n          }\n        }\n      });\n    },\n    \n    // 检查当前商品的收藏状态\n    checkCollectionStatus() {\n      if (!this.goods.id || !this.collectedGoodsList.length) {\n        this.goods.isCollected = false;\n        return;\n      }\n      \n      const isCollected = this.collectedGoodsList.some(item => \n        String(item.id) === String(this.goods.id)\n      );\n      \n      this.goods.isCollected = isCollected;\n      console.log('收藏状态检查:', this.goods.id, isCollected);\n    },\n    \n    // 获取所有商品数据\n    getAllCards() {\n      uni.request({\n        url: 'http://127.0.0.1:8080/cards/get', \n        method: 'GET',\n        success: (res) => {\n          if (res.data.code === 0) {\n            this.allGoodsList = res.data.data;  \n            if (this.goods.id) {\n              this.findGoodsById(this.goods.id);\n            }\n          }\n        }\n      });\n    },\n    \n    // 根据ID查找商品并赋值\n    findGoodsById(id) {\n      if (!id || !this.allGoodsList.length) return;\n      \n      const targetGoods = this.allGoodsList.find(item => \n        String(item.id) === String(id)\n      );\n      \n      if (targetGoods) {\n        this.goods = {\n          ...targetGoods,\n          isCollected: this.goods.isCollected // 保持原有的收藏状态\n        };\n        // 再次检查收藏状态\n        this.checkCollectionStatus();\n      }\n    },\n    Buy(){\n      const cookies = uni.getStorageSync('cookies');\n      uni.request({\n        url: `http://127.0.0.1:8080/cards/buy`,\n        method: 'POST',\n        data: { id: this.goods.id },\n        header: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n            'Cookie':  cookies\n          },\n          success: (res) => {\n              if (res.data && res.data.code === 0) {\n                uni.showToast({ title: '购买成功', icon: 'success' });\n              } else {\n                uni.showToast({ \n                  title: (res.data && res.data.message) || '购买失败', \n                  icon: 'none' \n                });\n              }\n            }\n          });\n    },\n    \n    toggleCollect() {\n      const cookies = uni.getStorageSync('cookies');\n      if (!this.goods.id) {\n        uni.showToast({ title: '商品ID不存在', icon: 'none' });\n        return;\n      }\n      \n      if (this.goods.isCollected) {\n        // 取消收藏\r\n\t\tconsole.log(\"取消收藏\"  )\n        uni.request({\n          url: `http://127.0.0.1:8080/cards/collect/delete`,\n          method: 'POST',\n          data: { cardId: this.goods.id },\n          header: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n              'Cookie':  cookies\n            },\n          success: (res) => {\n            if (res.data && res.data.code === 0) {\n              this.goods.isCollected = false;\n              this.collectedGoodsList = this.collectedGoodsList.filter(\n                item => item.id.toString() !== this.goods.id.toString()\n              );\n              uni.showToast({ title: '已取消收藏', icon: 'success' });\n            } else {\n              uni.showToast({ \n                title: (res.data && res.data.message) || '取消收藏失败', \n                icon: 'none' \n              });\n            }\n          }\n        });\n      } else {\n        // 添加收藏\r\n\t\tconsole.log(\"添加收藏\")\n        uni.request({\n          url: `http://127.0.0.1:8080/cards/collect/add`,\n          method: 'POST',\n          data: { id: this.goods.id},\n          header: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n              'Cookie':  cookies\n            },\n          success: (res) => {\n            if (res.data && res.data.code === 0) {\n              this.goods.isCollected = true;\n              this.collectedGoodsList.push({...this.goods});\n              uni.showToast({ title: '收藏成功', icon: 'success' });\n            } else {\n              console.log('服务器响应:', res.data);\n              uni.showToast({ \n                title: (res.data && res.data.message) || '收藏失败', \n                icon: 'none' \n              });\n            }\n          }\n        });\n      }\n    },\r\n\t    sendMessage() {\r\n\t      if (!this.messageContent.trim()) {\r\n\t        uni.showToast({\r\n\t          title: '消息内容不能为空',\r\n\t          icon: 'none'\r\n\t        });\r\n\t        return;\r\n\t      }\r\n\t      \r\n\t      const cookies = uni.getStorageSync('cookies');\r\n\t\t  console.log(this.messageContent);\r\n\t      uni.request({\r\n\t        url: 'http://127.0.0.1:8080/post/send',\r\n\t        method: 'POST',\r\n\t        data: {\r\n\t          sellerId: this.goods.sellerId,\r\n\t          message: this.messageContent,\r\n\t        },\r\n\t        header: {\r\n\t          'Content-Type': 'application/x-www-form-urlencoded',\r\n\t          'Cookie': cookies\r\n\t        },\r\n\t        success: (res) => {\r\n\t          if (res.data.code === 0) {\r\n\t            uni.showToast({\r\n\t              title: '消息发送成功',\r\n\t              icon: 'success'\r\n\t            });\r\n\t            this.messageContent = '';\r\n\t          } else {\r\n\t\t\t\t  console.log(res.data);\r\n\t            uni.showToast({\r\n\t              title: res.data.message || '消息发送失败',\r\n\t              icon: 'none'\r\n\t            });\r\n\t          }\r\n\t        },\r\n\t        fail: (err) => {\r\n\t          console.error('发送消息失败:', err);\r\n\t          uni.showToast({\r\n\t            title: '网络错误，发送失败',\r\n\t            icon: 'none'\r\n\t          });\r\n\t        }\r\n\t      });\r\n\t    },\n  },\r\n  updated() {\r\n      console.log('组件已更新，当前商品收藏状态:', this.goods.isCollected);\r\n    },\n  onLoad(options) {\r\n      if (options.id) {\r\n        this.goods.id = options.id;\r\n        this.getCollectedCards();\r\n        this.getAllCards();\r\n      }\r\n    }\r\n  }\n</script>\n<style>\n.container {\n  background-color: #ffffff;\n  min-height: 100vh;\n}\n\n.goods-image-container {\n  width: 100%;\n  height: 750rpx;\n  background-color: #f5f5f5;\n}\n\n.goods-image {\n  width: 100%;\n  height: 100%;\n}\n\n.goods-info {\n  padding: 30rpx;\n}\n\n.goods-title-container {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20rpx;\n}\n\n.goods-title {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333333;\n  max-width: 550rpx;\n}\n\n.goods-rare {\n  font-size: 28rpx;\n  color: #ffffff;\n  background-color: #ff6600;\n  padding: 6rpx 12rpx;\n  border-radius: 6rpx;\n}\n\n/* 价格 */\n.goods-price {\n  font-size: 40rpx;\n  font-weight: bold;\n  color: #ff5500;\n  margin: 20rpx 0;\n  display: block;\n}\n\n.goods-code {\n  font-size: 28rpx;\n  color: #666666;\n  display: block;\n  margin-bottom: 20rpx;\n}\n\n/* 卖家和价格 */\n.seller-price-container {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 40rpx;\n}\n\n.seller-name {\n  font-size: 28rpx;\n  color: #333333;\n}\n\n.goods-price {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #ff5500;\n}\n\n.action-buttons {\n  display: flex;\n  justify-content: center;\n  padding: 0 30rpx 60rpx;\n}\n\n.action-button {\n  width: 300rpx;\n  height: 88rpx;\n  border-radius: 44rpx;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 32rpx;\n  transition: all 0.3s; \n}\n\n.collect-btn {\n  color: #999999;\n  border: 2rpx solid #999999;\n  margin-right: 30rpx;\n}\n\n.collect-btn.collected {\n  color: #ffd700; \n  border-color: #ffd700; \n  background-color: rgba(255, 215, 0, 0.1); \n}\n\n.report-btn {\n  color: #000000;\n  border: 2rpx solid #ff0000;\n}\n\n.action-icon {\n  margin-right: 10rpx;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 30rpx;\n  padding-bottom: 20rpx;\n  border-bottom: 1rpx solid #f5f5f5;\n}\n\n.section-title {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333;\n}\n\r\n/* 发消息给卖家 */\n.message-seller {\n  padding: 30rpx;\n  background-color: #fff;\n  border-top: 1rpx solid #f5f5f5;\n  margin-top: 20rpx;\n}\n\n.message-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 20rpx;\n}\n\n.message-input {\n  width: 100%;\n  min-height: 150rpx;\n  background-color: #f9f9f9;\n  border-radius: 16rpx;\n  padding: 20rpx;\n  font-size: 28rpx;\n  margin-bottom: 20rpx;\n  box-sizing: border-box;\n}\n\n.send-button {\n  width: 100%;\n  height: 80rpx;\n  line-height: 80rpx;\n  background-color: #E5484D;\n  color: #fff;\n  border-radius: 40rpx;\n  font-size: 32rpx;\n}\n</style>","import MiniProgramPage from 'F:/uni-app/Newocg/ocg/pages/GoodsDetail/GoodsDetail.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}