{"version":3,"file":"myPublish.js","sources":["pages/card/myPublish.vue","D:/ -- HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2FyZC9teVB1Ymxpc2gudnVl"],"sourcesContent":["<template>\n  <view class=\"my-publish-container\">\n    <!-- 顶部标题 -->\n    <view class=\"header\">\n      <text class=\"title\">我的上架</text>\n    </view>\n\n    <!-- 卡牌列表 -->\n    <scroll-view \n      class=\"card-list\" \n      scroll-y\n      @scrolltolower=\"loadMore\"\n      refresher-enabled\n      :refresher-triggered=\"isRefreshing\"\n      @refresherrefresh=\"refreshData\"\n    >\n      <view \n        class=\"card-item\" \n        v-for=\"(card, index) in onShelfCards\" \n        :key=\"index\"\n      >\n        <image class=\"card-image\" :src=\"card.cardGraph\" mode=\"aspectFill\"></image>\n        <view class=\"card-info\">\n          <view class=\"card-header\">\n            <text class=\"card-name\">{{card.name}}</text>\n            <text class=\"card-price\">¥{{card.price}}</text>\n          </view>\n          <view class=\"card-meta\">\n            <text class=\"meta-item\">编号: {{card.cardNumber}}</text>\n            <text class=\"meta-item\">稀有度: {{card.rarity || card.parity}}</text>\n          </view>\n          <view class=\"card-footer\">\n            <text class=\"attention\">关注: {{card.attention || 0}}次</text>\n          </view>\n        </view>\n        <view class=\"card-actions\">\n          <button class=\"action-btn off\" @click=\"offShelf(card.id)\">下架</button>\n        </view>\n      </view>\n      \n      <view class=\"empty-tip\" v-if=\"onShelfCards.length === 0 && !isLoading\">\n        <image src=\"/static/empty-card.png\" mode=\"aspectFit\"></image>\n        <text>暂无上架中的卡牌</text>\n        <button class=\"publish-btn\" @click=\"navigateToPublish\">发布卡牌</button>\n      </view>\n\n      \n      <view class=\"load-more\" v-if=\"hasMore\">\n        <text>{{isLoading ? '加载中...' : '上拉加载更多'}}</text>\n      </view>\n      <view class=\"no-more\" v-else>\n        <text>没有更多了</text>\n      </view>\n    </scroll-view>\n\n    <!-- 底部发布按钮 -->\n    <view class=\"publish-btn\" @click=\"navigateToPublish\" v-if=\"onShelfCards.length > 0\">\n      <text>+ 发布新卡牌</text>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      onShelfCards: [],  \n      isLoading: false,\n      isRefreshing: false,\n      currentPage: 1,\n      pageSize: 10,\n      hasMore: true,\n      cookies: ''\n    }\n  },\n  onShow() {\n    this.checkLogin()\n    this.refreshData()\n  },\n  methods: {\n    // 检查登录状态\n    checkLogin() {\n      this.cookies = uni.getStorageSync('cookies')\n      if (!this.cookies) {\n        uni.showToast({\n          title: '请先登录',\n          icon: 'none'\n        })\n        setTimeout(() => {\n          uni.navigateTo({\n            url: '/pages/login/login'\n          })\n        }, 1500)\n        return false\n      }\n      return true\n    },\n    \n    // 刷新数据\n    refreshData() {\n      this.isRefreshing = true\n      this.currentPage = 1\n      this.hasMore = true\n      this.loadData(true)\n    },\n    \n    // 加载更多数据\n    loadMore() {\n      if (!this.isLoading && this.hasMore) {\n        this.currentPage++\n        this.loadData()\n      }\n    },\n    \n    // 加载数据\n    async loadData(isRefresh = false) {\n      if (this.isLoading) return\n      \n      this.isLoading = true\n      if (isRefresh) {\n        this.onShelfCards = []\n      }\n      \n      try {\n        const res = await this.request({\n          url: '/cards/get/own',\n          method: 'GET',\n          header: {\n            'Cookie': this.cookies\n          }\n        })\n        \n        if (res.data.code === 0) {\n          const newCards = res.data.data || []\n          \n          if (isRefresh) {\n            this.onShelfCards = newCards\n          } else {\n            this.onShelfCards = [...this.onShelfCards, ...newCards]\n          }\n          \n          // 判断是否还有更多数据\n          this.hasMore = newCards.length >= this.pageSize\n        } else if (res.data.code === 401) {\n          this.handleUnauthorized()\n        }\n      } catch (error) {\n        console.error('加载数据失败:', error)\n        uni.showToast({\n          title: '加载失败，请重试',\n          icon: 'none'\n        })\n      } finally {\n        this.isLoading = false\n        this.isRefreshing = false\n      }\n    },\n    \n    // 访问控制\n    handleUnauthorized() {\n      uni.removeStorageSync('cookies')\n      uni.showToast({\n        title: '登录已过期，请重新登录',\n        icon: 'none'\n      })\n      setTimeout(() => {\n        uni.navigateTo({\n          url: '/pages/login/login'\n        })\n      }, 1500)\n    },\n    \n    // 下架卡牌\n    async offShelf(id) {\n      uni.showModal({\n        title: '提示',\n        content: '确定要下架该卡牌吗？',\n        success: async (res) => {\n          if (res.confirm) {\n            uni.showLoading({\n              title: '处理中...'\n            })\n            \n            try {\n              const result = await this.request({\n                url: '/cards/delete',\n                method: 'POST',\n                data: { id },\n                header: {\n                  'Cookie': this.cookies,\n                  'Content-Type': 'application/x-www-form-urlencoded'\n                }\n              })\n              \n              if (result.data.code === 0) {\n                this.onShelfCards = this.onShelfCards.filter(card => card.id !== id)\n                uni.showToast({\n                  title: '已下架',\n                  icon: 'success'\n                })\n              }\n            } catch (error) {\n              console.error('下架失败:', error)\n              uni.showToast({\n                title: '下架失败',\n                icon: 'none'\n              })\n            } finally {\n              uni.hideLoading()\n            }\n          }\n        }\n      })\n    },\n    \n    // 跳转到发布页面\n    navigateToPublish() {\n      uni.navigateTo({\n        url: '/pages/card/publish'\n      })\n    },\n    \n    // 请求\n    request(options) {\n      return new Promise((resolve, reject) => {\n        uni.request({\n          url: 'http://127.0.0.1:8080' + options.url,\n          method: options.method || 'GET',\n          data: options.data || {},\n          header: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n            ...options.header\n          },\n          success: (res) => {\n            if (res.statusCode === 401) {\n              this.handleUnauthorized()\n              reject(new Error('未授权'))\n              return\n            }\n            resolve(res)\n          },\n          fail: (err) => {\n            reject(err)\n          }\n        })\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.my-publish-container {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  background-color: #f5f5f5;\n}\n\n.header {\n  padding: 20rpx 30rpx;\n  background-color: #fff;\n  border-bottom: 1rpx solid #eee;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333;\n}\n\n.card-list {\n  flex: 1;\n  padding: 20rpx;\n}\n\n.card-item {\n  display: flex;\n  background-color: #fff;\n  border-radius: 12rpx;\n  margin-bottom: 20rpx;\n  padding: 20rpx;\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.05);\n}\n\n.card-image {\n  width: 180rpx;\n  height: 240rpx;\n  border-radius: 8rpx;\n  margin-right: 20rpx;\n}\n\n.card-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 15rpx;\n}\n\n.card-name {\n  font-size: 30rpx;\n  font-weight: bold;\n  flex: 1;\n  margin-right: 20rpx;\n}\n\n.card-price {\n  font-size: 30rpx;\n  color: #ff6b81;\n  font-weight: bold;\n}\n\n.card-meta {\n  margin-bottom: 15rpx;\n}\n\n.meta-item {\n  display: block;\n  font-size: 24rpx;\n  color: #999;\n  margin-bottom: 8rpx;\n}\n\n.card-footer {\n  margin-top: auto;\n  display: flex;\n  justify-content: flex-start;\n}\n\n.attention {\n  font-size: 22rpx;\n  color: #999;\n}\n\n.card-actions {\n  display: flex;\n  flex-direction: column;\n  margin-left: 20rpx;\n  justify-content: center;\n}\n\n.action-btn {\n  width: 120rpx;\n  height: 60rpx;\n  line-height: 60rpx;\n  font-size: 24rpx;\n  padding: 0;\n  border-radius: 30rpx;\n}\n\n.off {\n  background-color: #fff;\n  color: #ff4757;\n  border: 1rpx solid #ff4757;\n}\n\n.empty-tip {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 100rpx 0;\n  color: #999;\n}\n\n.empty-tip image {\n  width: 200rpx;\n  height: 200rpx;\n  margin-bottom: 30rpx;\n  opacity: 0.5;\n}\n\n.empty-tip text {\n  font-size: 28rpx;\n  margin-bottom: 30rpx;\n}\n\n.empty-tip .publish-btn {\n  width: 300rpx;\n  height: 80rpx;\n  line-height: 80rpx;\n  text-align: center;\n  background-color: #ff6b81;\n  color: #fff;\n  border-radius: 40rpx;\n  font-size: 30rpx;\n  box-shadow: 0 4rpx 12rpx rgba(255, 107, 129, 0.3);\n}\n\n.publish-btn {\n  position: fixed;\n  bottom: 40rpx;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 300rpx;\n  height: 80rpx;\n  line-height: 80rpx;\n  text-align: center;\n  background-color: #ff6b81;\n  color: #fff;\n  border-radius: 40rpx;\n  font-size: 30rpx;\n  box-shadow: 0 4rpx 12rpx rgba(255, 107, 129, 0.3);\n}\n\n.load-more, .no-more {\n  text-align: center;\n  padding: 20rpx 0;\n  font-size: 26rpx;\n  color: #999;\n}\n</style>","import MiniProgramPage from 'F:/uni-app/Newocg/ocg/pages/card/myPublish.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}