{"version":3,"file":"publish.js","sources":["pages/card/publish.vue","D:/ -- HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2FyZC9wdWJsaXNoLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"publish-container\">\n    <!-- 标题栏 -->\n    <view class=\"header\">\n      <text class=\"title\">发布卡牌</text>\n      <text class=\"cancel-btn\" @click=\"cancel\">取消</text>\n    </view>\n\n    <!-- 表单 -->\n    <scroll-view class=\"form-container\" scroll-y>\n      \n      <view class=\"form-section\">\n        <text class=\"section-title\">卡牌图片URL</text>\n        <view class=\"form-item\">\n          <input \n            class=\"input\" \n            v-model=\"cardInfo.cardGraph\" \n            placeholder=\"请输入卡牌图片URL\"\n          />\n        </view>\n      </view>\n\n      <!-- 卡牌基本信息 -->\n      <view class=\"form-section\">\n        <text class=\"section-title\">卡牌信息</text>\n        <view class=\"form-item\">\n          <text class=\"label\">卡牌名称</text>\n          <input \n            class=\"input\" \n            v-model=\"cardInfo.name\" \n            placeholder=\"请输入卡牌名称\"\n          />\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">卡牌编号</text>\n          <input \n            class=\"input\" \n            v-model=\"cardInfo.cardNumber\" \n            placeholder=\"请输入卡牌编号\"\n            type=\"number\"\n          />\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">价格</text>\n          <input \n            class=\"input price-input\" \n            v-model=\"cardInfo.price\" \n            type=\"number\" \n            placeholder=\"0.00\"\n          />\n          <text class=\"currency\">¥</text>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">稀有度</text>\n          <input \n            class=\"input\" \n            v-model=\"cardInfo.rarity\" \n            placeholder=\"请输入稀有度\"\n          />\n        </view>\n      </view>\n    </scroll-view>\n\n    <!-- 底部操作栏 -->\n    <view class=\"footer\">\n      <button class=\"publish-btn\" @click=\"publish\">发布</button>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      cardInfo: {\n        cardGraph: '', \n        cardNumber: '',\n        name: '',\n        price: '',\n        rarity: ''\n      }\n    }\n  },\n  methods: {\n    // 发布卡牌\n    checkLogin() {\r\n        const cookies = uni.getStorageSync('cookies');\r\n        if (!cookies) {\r\n          uni.showToast({\r\n            title: '请先登录',\r\n            icon: 'none'\r\n          });\r\n          setTimeout(() => {\r\n            uni.navigateTo({\r\n              url: '/pages/login/login'\r\n            });\r\n          }, 1500);\r\n          return false;\r\n        }\r\n        return true;\r\n      },\r\n      \r\n      \r\n      publish() {\r\n        \r\n        if (!this.checkLogin()) return;\r\n        \r\n        if (!this.validateForm()) return;\r\n        \r\n        uni.showLoading({\r\n          title: '发布中...'\r\n        });\r\n        \r\n        \r\n        const cookies = uni.getStorageSync('cookies');\r\n        \r\n        \r\n        const requestData = {\r\n          cardGraph: this.cardInfo.cardGraph,\r\n          cardNumber: parseInt(this.cardInfo.cardNumber),\r\n          name: this.cardInfo.name,\r\n          price: parseFloat(this.cardInfo.price),\r\n          rarity: this.cardInfo.rarity\r\n        };\r\n        \r\n        \r\n        uni.request({\r\n          url: 'http://127.0.0.1:8080/cards/add',\r\n          method: 'POST',\r\n          data: requestData,\r\n          header: {\r\n            'Content-Type': 'application/x-www-form-urlencoded',\r\n            'Cookie': cookies \r\n          },\r\n          success: (res) => {\r\n            // 处理未授权情况\r\n            if (res.statusCode === 401) {\r\n              uni.showToast({\r\n                title: '登录已过期，请重新登录',\r\n                icon: 'none'\r\n              });\r\n              uni.removeStorageSync('cookies');\r\n              setTimeout(() => {\r\n                uni.navigateTo({\r\n                  url: '/pages/login/login'\r\n                });\r\n              }, 1500);\r\n              return;\r\n            }\r\n            \r\n            if (res.data.code === 0) {\r\n              uni.showToast({\r\n                title: '发布成功',\r\n                icon: 'success'\r\n              });\r\n              setTimeout(() => {\r\n                uni.navigateBack();\r\n              }, 1500);\r\n            } else {\r\n              uni.showToast({\r\n                title: res.data.message || '发布失败',\r\n                icon: 'none'\r\n              });\r\n            }\r\n          },\r\n          fail: (err) => {\r\n            uni.showToast({\r\n              title: '网络错误，请重试',\r\n              icon: 'none'\r\n            });\r\n            console.error('请求失败:', err);\r\n          },\r\n          complete: () => {\r\n            uni.hideLoading();\r\n          }\r\n        });\r\n      },\n    \n    // 表单验证\n    validateForm() {\n      if (!this.cardInfo.cardGraph) {\n        uni.showToast({\n          title: '请输入卡牌图片URL',\n          icon: 'none'\n        })\n        return false\n      }\n      \n      if (!this.cardInfo.name) {\n        uni.showToast({\n          title: '请输入卡牌名称',\n          icon: 'none'\n        })\n        return false\n      }\n      \n      if (!this.cardInfo.cardNumber) {\n        uni.showToast({\n          title: '请输入卡牌编号',\n          icon: 'none'\n        })\n        return false\n      }\n      \n      if (!this.cardInfo.price) {\n        uni.showToast({\n          title: '请输入价格',\n          icon: 'none'\n        })\n        return false\n      }\n      \n      if (!this.cardInfo.rarity) {\n        uni.showToast({\n          title: '请输入稀有度',\n          icon: 'none'\n        })\n        return false\n      }\n      \n      return true\n    },\n    \n    // 取消\n    cancel() {\n      uni.navigateBack()\n    }\n  }\n}\n</script>\n\n<style scoped>\n.publish-container {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  background-color: #f5f5f5;\n}\n\n/* 头部样式 */\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20rpx 30rpx;\n  background-color: #fff;\n  border-bottom: 1rpx solid #eee;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: bold;\n}\n\n.cancel-btn {\n  font-size: 30rpx;\n  color: #666;\n}\n\n/* 表单容器 */\n.form-container {\n  flex: 1;\n  padding: 20rpx;\n}\n\n.form-section {\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 30rpx;\n  margin-bottom: 20rpx;\n}\n\n.section-title {\n  display: block;\n  font-size: 32rpx;\n  font-weight: bold;\n  margin-bottom: 30rpx;\n  color: #333;\n}\n\n/* 表单项目 */\n.form-item {\n  display: flex;\n  align-items: center;\n  padding: 25rpx 0;\n  border-bottom: 1rpx solid #f0f0f0;\n}\n\n.label {\n  width: 180rpx;\n  font-size: 28rpx;\n  color: #666;\n}\n\n.input {\n  flex: 1;\n  font-size: 28rpx;\n  height: 40rpx;\n  line-height: 40rpx;\n}\n\n.price-input {\n  text-align: right;\n  padding-right: 40rpx;\n}\n\n.currency {\n  position: absolute;\n  right: 30rpx;\n  font-size: 28rpx;\n}\n\n/* 底部操作栏 */\n.footer {\n  display: flex;\n  padding: 20rpx;\n  background-color: #fff;\n  border-top: 1rpx solid #eee;\n}\n\n.publish-btn {\n  flex: 1;\n  background-color: #ff6b81;\n  color: #fff;\n  border-radius: 50rpx;\n  font-size: 30rpx;\n  height: 80rpx;\n  line-height: 80rpx;\n}\n</style>","import MiniProgramPage from 'F:/uni-app/Newocg/ocg/pages/card/publish.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}