{"version":3,"file":"message.js","sources":["pages/message/message.vue","D:/ -- HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVzc2FnZS9tZXNzYWdlLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"message-container\">\n    <!-- 顶部标题 -->\n    <view class=\"header\">\n      <text class=\"title\">消息中心</text>\n    </view>\n\n    <!-- 接收者输入 -->\n    <view class=\"input-group\">\n      <text class=\"input-label\">发送给用户ID：</text>\n      <input \n        class=\"input\" \n        v-model=\"receiverId\" \n        placeholder=\"输入接收者ID\" \n        type=\"number\"\n      />\n    </view>\n\n    <!-- 消息列表 -->\n    <scroll-view class=\"message-list\" scroll-y>\n      <view \n        class=\"message-item\" \n        v-for=\"(message, index) in messages\" \n        :key=\"index\"\n        :class=\"{ 'my-message': message.buyerId === myId }\"\n      >\n        <view class=\"message-header\">\n          <text class=\"user-info\">\n            {{ message.buyerId === myId ? \n              `我 → 用户${message.sellerId}` : \n              `用户${message.buyerId} → 我` }}\n          </text>\n          <text class=\"time\">{{formatTime(message.creatTime)}}</text>\n        </view>\n        <text class=\"message-content\">{{message.message}}</text>\n      </view>\n\n      <view class=\"empty-tip\" v-if=\"messages.length === 0\">\n        <text>暂无消息记录</text>\n      </view>\n    </scroll-view>\n\n    <!-- 消息输入 -->\n    <view class=\"message-input\">\n      <input \n        class=\"input\" \n        v-model=\"messageContent\" \n        placeholder=\"输入消息内容...\" \n        @confirm=\"sendMessage\"\n      />\n      <button class=\"send-btn\" @click=\"sendMessage\">发送</button>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      myId: uni.getStorageSync('userId') || 1,  \n      receiverId: '',      \n      messageContent: '',  \n      messages: []        \n    }\n  },\n  onShow() {\n    this.loadMessages()\n  },\n  methods: {\n    // 格式化时间\n    formatTime(time) {\n      return new Date(time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n    },\n\n    // 加载消息记录\n    async loadMessages() {\n      try {\n        const res = await uni.request({\n          url: 'http://127.0.0.1:8080/post/get',\n          method: 'GET',\n          data: { \n            userId: this.myId \n          },\n          header: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n            'Cookie': uni.getStorageSync('cookies')\n          }\n        })\n\n        const resData = res[1]?.data || res.data\n        if (resData?.code === 0) {\n          this.messages = resData.data || []\n          // 按时间倒序排列\n          this.messages.sort((a, b) => new Date(b.creatTime) - new Date(a.creatTime))\n        }\n      } catch (error) {\n        uni.showToast({ title: '加载消息失败', icon: 'none' })\n      }\n    },\n\n    // 发送消息\n    async sendMessage() {\n      if (!this.receiverId || !this.messageContent.trim()) {\n        uni.showToast({ title: '请填写完整信息', icon: 'none' })\n        return\n      }\n\n      try {\n        uni.showLoading({ title: '发送中...' })\n        \n        const res = await uni.request({\n          url: 'http://127.0.0.1:8080/post/send',\n          method: 'POST',\n          header: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n            'Cookie': uni.getStorageSync('cookies')\n          },\n          data: {\n            message: this.messageContent,\n            sellerId: this.receiverId,  \n            buyerId: this.myId          \n          }\n        })\n\n        const resData = res[1]?.data || res.data\n        if (resData?.code === 0) {\n          // 添加到消息列表顶部\n          this.messages.unshift({\n            message: this.messageContent,\n            sellerId: this.receiverId,\n            buyerId: this.myId,\n            creatTime: new Date().toISOString()\n          })\n          this.messageContent = ''\n          uni.showToast({ title: '发送成功', icon: 'success' })\n        }\n      } catch (error) {\n        uni.showToast({ title: '发送失败: ' + (error.message || ''), icon: 'none' })\n      } finally {\n        uni.hideLoading()\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.message-container {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  background-color: #f5f5f5;\n  padding: 20rpx;\n}\n\n.header {\n  padding: 20rpx;\n  background-color: #fff;\n  border-bottom: 1rpx solid #eee;\n}\n\n.input-group {\n  display: flex;\n  align-items: center;\n  background-color: #fff;\n  padding: 15rpx;\n  margin-bottom: 20rpx;\n  border-radius: 8rpx;\n}\n\n.input-label {\n  font-size: 28rpx;\n  margin-right: 15rpx;\n}\n\n.message-list {\n  flex: 1;\n  margin-bottom: 140rpx;\n}\n\n.message-item {\n  background-color: #fff;\n  border-radius: 12rpx;\n  padding: 20rpx;\n  margin-bottom: 15rpx;\n}\n\n.my-message {\n  background-color: #e1f5fe;\n}\n\n.message-header {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 10rpx;\n}\n\n.user-info {\n  font-weight: bold;\n  color: #333;\n}\n\n.time {\n  color: #999;\n  font-size: 24rpx;\n}\n\n.message-content {\n  font-size: 28rpx;\n}\n\n.empty-tip {\n  text-align: center;\n  padding: 100rpx;\n  color: #999;\n}\n\n.message-input {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  padding: 20rpx;\n  background-color: #fff;\n  border-top: 1rpx solid #eee;\n  display: flex;\n}\n\n.input {\n  flex: 1;\n  height: 70rpx;\n  padding: 0 20rpx;\n  background-color: #f5f5f5;\n  border-radius: 35rpx;\n  margin-right: 15rpx;\n}\n\n.send-btn {\n  width: 120rpx;\n  height: 70rpx;\n  background-color: #07c160;\n  color: #fff;\n  border-radius: 35rpx;\n}\n</style>","import MiniProgramPage from 'F:/uni-app/Newocg/ocg/pages/message/message.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AAwDA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,MAAMA,cAAG,MAAC,eAAe,QAAQ,KAAK;AAAA,MACtC,YAAY;AAAA,MACZ,gBAAgB;AAAA,MAChB,UAAU,CAAC;AAAA,IACb;AAAA,EACD;AAAA,EACD,SAAS;AACP,SAAK,aAAa;AAAA,EACnB;AAAA,EACD,SAAS;AAAA;AAAA,IAEP,WAAW,MAAM;AACf,aAAO,IAAI,KAAK,IAAI,EAAE,mBAAmB,CAAA,GAAI,EAAE,MAAM,WAAW,QAAQ,WAAW;AAAA,IACpF;AAAA;AAAA,IAGD,MAAM,eAAe;;AACnB,UAAI;AACF,cAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC5B,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM;AAAA,YACJ,QAAQ,KAAK;AAAA,UACd;AAAA,UACD,QAAQ;AAAA,YACN,gBAAgB;AAAA,YAChB,UAAUA,cAAAA,MAAI,eAAe,SAAS;AAAA,UACxC;AAAA,SACD;AAED,cAAM,YAAU,SAAI,CAAC,MAAL,mBAAQ,SAAQ,IAAI;AACpC,aAAI,mCAAS,UAAS,GAAG;AACvB,eAAK,WAAW,QAAQ,QAAQ,CAAC;AAEjC,eAAK,SAAS,KAAK,CAAC,GAAG,MAAM,IAAI,KAAK,EAAE,SAAS,IAAI,IAAI,KAAK,EAAE,SAAS,CAAC;AAAA,QAC5E;AAAA,MACA,SAAO,OAAO;AACdA,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAAA,MACjD;AAAA,IACD;AAAA;AAAA,IAGD,MAAM,cAAc;;AAClB,UAAI,CAAC,KAAK,cAAc,CAAC,KAAK,eAAe,QAAQ;AACnDA,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,QAAQ;AAChD;AAAA,MACF;AAEA,UAAI;AACFA,sBAAAA,MAAI,YAAY,EAAE,OAAO,UAAU;AAEnC,cAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC5B,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,QAAQ;AAAA,YACN,gBAAgB;AAAA,YAChB,UAAUA,cAAAA,MAAI,eAAe,SAAS;AAAA,UACvC;AAAA,UACD,MAAM;AAAA,YACJ,SAAS,KAAK;AAAA,YACd,UAAU,KAAK;AAAA,YACf,SAAS,KAAK;AAAA,UAChB;AAAA,SACD;AAED,cAAM,YAAU,SAAI,CAAC,MAAL,mBAAQ,SAAQ,IAAI;AACpC,aAAI,mCAAS,UAAS,GAAG;AAEvB,eAAK,SAAS,QAAQ;AAAA,YACpB,SAAS,KAAK;AAAA,YACd,UAAU,KAAK;AAAA,YACf,SAAS,KAAK;AAAA,YACd,YAAW,oBAAI,KAAM,GAAC,YAAY;AAAA,WACnC;AACD,eAAK,iBAAiB;AACtBA,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAAA,QAClD;AAAA,MACA,SAAO,OAAO;AACdA,sBAAAA,MAAI,UAAU,EAAE,OAAO,YAAY,MAAM,WAAW,KAAK,MAAM,QAAQ;AAAA,MACzE,UAAU;AACRA,sBAAAA,MAAI,YAAY;AAAA,MAClB;AAAA,IACF;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;AC9IA,GAAG,WAAW,eAAe;"}