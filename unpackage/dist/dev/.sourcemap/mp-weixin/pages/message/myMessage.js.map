{"version":3,"file":"myMessage.js","sources":["pages/message/myMessage.vue","D:/ -- HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVzc2FnZS9teU1lc3NhZ2UudnVl"],"sourcesContent":["<template>\n  <view class=\"message-container\">\n    <!-- 顶部标题 -->\n    <view class=\"header\">\n      <text class=\"title\">我的消息</text>\n      <text class=\"refresh\" @click=\"loadMessages\">刷新</text>\n    </view>\n\n    <!-- 消息列表 -->\n    <scroll-view class=\"message-list\" scroll-y>\n      <view \n        class=\"message-item\" \n        v-for=\"(message, index) in messages\" \n        :key=\"index\"\n      >\n        <view class=\"message-header\">\n          \n          <text class=\"sender\">用户 {{message.buyerId}} → 用户 {{message.sellerId}}</text>\n          <text class=\"time\">{{formatTime(message.creatTime)}}</text>\n        </view>\n        <text class=\"message-content\">{{message.message}}</text>\n      </view>\n\n      <view v-if=\"loading\" class=\"loading-tip\">\n        <text>加载中...</text>\n      </view>\n      \n      <view v-if=\"messages.length === 0 && !loading\" class=\"empty-tip\">\n        <text>暂无消息记录</text>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      myId: uni.getStorageSync('userId') || 1, \n      messages: [], \n      loading: false \n    }\n  },\n  onShow() {\n    this.loadMessages()\n  },\n  methods: {\n    // 格式化时间\n    formatTime(time) {\n      if (!time) return ''\n      const date = new Date(time)\n      const pad = num => num.toString().padStart(2, '0')\n      return `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())} ${pad(date.getHours())}:${pad(date.getMinutes())}`\n    },\n    \n    // 加载消息\n    async loadMessages() {\n      this.loading = true\n      try {\n        // 获取当前用户作为接收者的所有消息\n        const res = await new Promise((resolve, reject) => {\n          uni.request({\n            url: 'http://127.0.0.1:8080/post/get',\n            method: 'GET',\n            data: {\n              sellerId: this.myId \n            },\n            header: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n              'Cookie': uni.getStorageSync('cookies')\n            },\n            success: (res) => {\n              if (res.statusCode === 200) {\n                resolve(res)\n              } else {\n                reject(new Error(`请求失败，状态码: ${res.statusCode}`))\n              }\n            },\n            fail: (err) => {\n              reject(err)\n            }\n          })\n        })\n\n        const responseData = res.data || {}\n        \n        if (responseData.code === 0) {\n          this.messages = Array.isArray(responseData.data) ? responseData.data : []\n          // 按时间倒序排列\n          this.messages.sort((a, b) => new Date(b.creatTime) - new Date(a.creatTime))\n          \n          console.log('消息数据:', this.messages) \n        }\n      } catch (error) {\n        console.error('加载失败:', error)\n        uni.showToast({\n          title: '加载失败: ' + (error.message || '未知错误'),\n          icon: 'none'\n        })\n      } finally {\n        this.loading = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n/* 样式 */\n.message-container {\n  height: 100vh;\n  background-color: #f8f8f8;\n}\n\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 15px;\n  background-color: #fff;\n  border-bottom: 1px solid #eee;\n}\n\n.title {\n  font-size: 18px;\n  font-weight: bold;\n}\n\n.refresh {\n  color: #07c160;\n  font-size: 14px;\n}\n\n.message-list {\n  padding: 10px;\n  height: calc(100vh - 60px);\n}\n\n.message-item {\n  background-color: #fff;\n  border-radius: 8px;\n  padding: 15px;\n  margin-bottom: 10px;\n  box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n}\n\n.message-header {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 8px;\n}\n\n.sender {\n  font-weight: bold;\n  color: #333;\n}\n\n.time {\n  color: #999;\n  font-size: 12px;\n}\n\n.message-content {\n  color: #333;\n  line-height: 1.5;\n}\n\n.loading-tip, .empty-tip {\n  text-align: center;\n  padding: 20px;\n  color: #999;\n}\n</style>","import MiniProgramPage from 'F:/uni-app/Newocg/ocg/pages/message/myMessage.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","res"],"mappings":";;AAmCA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,MAAMA,cAAG,MAAC,eAAe,QAAQ,KAAK;AAAA,MACtC,UAAU,CAAE;AAAA,MACZ,SAAS;AAAA,IACX;AAAA,EACD;AAAA,EACD,SAAS;AACP,SAAK,aAAa;AAAA,EACnB;AAAA,EACD,SAAS;AAAA;AAAA,IAEP,WAAW,MAAM;AACf,UAAI,CAAC;AAAM,eAAO;AAClB,YAAM,OAAO,IAAI,KAAK,IAAI;AAC1B,YAAM,MAAM,SAAO,IAAI,SAAQ,EAAG,SAAS,GAAG,GAAG;AACjD,aAAO,GAAG,KAAK,YAAW,CAAE,IAAI,IAAI,KAAK,SAAQ,IAAG,CAAC,CAAC,IAAI,IAAI,KAAK,QAAO,CAAE,CAAC,IAAI,IAAI,KAAK,SAAQ,CAAE,CAAC,IAAI,IAAI,KAAK,WAAU,CAAE,CAAC;AAAA,IAChI;AAAA;AAAA,IAGD,MAAM,eAAe;AACnB,WAAK,UAAU;AACf,UAAI;AAEF,cAAM,MAAM,MAAM,IAAI,QAAQ,CAAC,SAAS,WAAW;AACjDA,wBAAAA,MAAI,QAAQ;AAAA,YACV,KAAK;AAAA,YACL,QAAQ;AAAA,YACR,MAAM;AAAA,cACJ,UAAU,KAAK;AAAA,YAChB;AAAA,YACD,QAAQ;AAAA,cACN,gBAAgB;AAAA,cAChB,UAAUA,cAAAA,MAAI,eAAe,SAAS;AAAA,YACvC;AAAA,YACD,SAAS,CAACC,SAAQ;AAChB,kBAAIA,KAAI,eAAe,KAAK;AAC1B,wBAAQA,IAAG;AAAA,qBACN;AACL,uBAAO,IAAI,MAAM,aAAaA,KAAI,UAAU,EAAE,CAAC;AAAA,cACjD;AAAA,YACD;AAAA,YACD,MAAM,CAAC,QAAQ;AACb,qBAAO,GAAG;AAAA,YACZ;AAAA,WACD;AAAA,SACF;AAED,cAAM,eAAe,IAAI,QAAQ,CAAC;AAElC,YAAI,aAAa,SAAS,GAAG;AAC3B,eAAK,WAAW,MAAM,QAAQ,aAAa,IAAI,IAAI,aAAa,OAAO,CAAC;AAExE,eAAK,SAAS,KAAK,CAAC,GAAG,MAAM,IAAI,KAAK,EAAE,SAAS,IAAI,IAAI,KAAK,EAAE,SAAS,CAAC;AAE1ED,wBAAY,MAAA,MAAA,OAAA,qCAAA,SAAS,KAAK,QAAQ;AAAA,QACpC;AAAA,MACA,SAAO,OAAO;AACdA,sBAAAA,MAAc,MAAA,SAAA,qCAAA,SAAS,KAAK;AAC5BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO,YAAY,MAAM,WAAW;AAAA,UACpC,MAAM;AAAA,SACP;AAAA,MACH,UAAU;AACR,aAAK,UAAU;AAAA,MACjB;AAAA,IACF;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;ACvGA,GAAG,WAAW,eAAe;"}